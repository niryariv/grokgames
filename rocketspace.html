<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>Rocketspace</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #111;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            border: 1px solid white;
            background: black;
            display: none;
        }
        #introScreen, #endScreen {
            text-align: center;
            color: white;
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #1a1a3d 0%, #111 100%);
        }
        #introScreen h1, #endScreen h1 {
            font-size: 80px;
            text-shadow: 0 0 10px cyan, 0 0 20px blue;
            animation: glow 2s infinite alternate;
        }
        #startButton, #restartButton {
            padding: 15px 30px;
            font-size: 24px;
            background: linear-gradient(45deg, cyan, blue);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            text-shadow: 0 0 5px black;
            transition: transform 0.2s;
        }
        #startButton:hover, #restartButton:hover {
            transform: scale(1.1);
        }
        #endScreen p {
            font-size: 30px;
            margin: 20px 0;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px cyan, 0 0 20px blue; }
            to { text-shadow: 0 0 20px cyan, 0 0 40px blue; }
        }
        .ui-box {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid cyan;
            border-radius: 10px;
            padding: 10px;
            display: inline-block;
            text-shadow: 0 0 5px cyan;
        }
    </style>
</head>
<body>
    <div id="introScreen">
        <h1>Rocketspace</h1>
        <button id="startButton">התחל משחק</button>
    </div>
    <div id="endScreen" style="display: none;">
        <h1>משחק נגמר!</h1>
        <p id="finalScore"></p>
        <button id="restartButton">שחק שוב</button>
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const introScreen = document.getElementById('introScreen');
        const endScreen = document.getElementById('endScreen');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const finalScoreText = document.getElementById('finalScore');

        // אובייקט החללית
        const spaceship = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 50,
            height: 40,
            speed: 5,
            wingAngle: 0,
            flameSize: 0,
            lives: 3
        };

        let bullets = [];
        let shapes = [];
        const baseSpeed = 1;
        let particles = [];
        let stars = [];
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2 + 1,
                speed: Math.random() * 0.5 + 0.1
            });
        }
        let shake = 0;
        const shapeTypes = [
            { type: 'square', size: 45, speed: baseSpeed, points: 10, color: 'green', rotation: 0 },
            { type: 'triangle', size: 37.5, speed: baseSpeed * 1.5, points: 20, color: 'yellow', rotation: 0 },
            { type: 'circle', size: 30, speed: baseSpeed * 2, points: 30, color: 'blue', rotation: 0 },
            { type: 'pentagon', size: 52.5, speed: baseSpeed * 1.2, points: 15, color: 'purple', rotation: 0 }
        ];
        let rightPressed = false;
        let leftPressed = false;
        let spacePressed = false;
        let score = 0;

        function keyDownHandler(e) {
            if (e.key === 'Right' || e.key === 'ArrowRight') rightPressed = true;
            if (e.key === 'Left' || e.key === 'ArrowLeft') leftPressed = true;
            if (e.key === ' ') spacePressed = true;
        }

        function keyUpHandler(e) {
            if (e.key === 'Right' || e.key === 'ArrowRight') rightPressed = false;
            if (e.key === 'Left' || e.key === 'ArrowLeft') leftPressed = false;
            if (e.key === ' ') spacePressed = false;
        }

        function spawnShape() {
            const shape = { ...shapeTypes[Math.floor(Math.random() * shapeTypes.length)] };
            const x = Math.random() * (canvas.width - shape.size);
            shape.x = x;
            shape.y = -shape.size;
            shape.rotationSpeed = Math.random() * 0.05 - 0.025;
            shapes.push(shape);
        }

        function createExplosion(x, y, color, isShip = false) {
            const particleCount = isShip ? 20 : 10;
            const particleSize = isShip ? 8 : 5;
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * particleSize + 2,
                    speedX: Math.random() * 6 - 3,
                    speedY: Math.random() * 6 - 3,
                    life: isShip ? 30 : 20,
                    color: isShip ? 'orange' : color
                });
            }
            shake = isShip ? 10 : 5;
        }

        function drawStars() {
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
                star.y += star.speed;
                if (star.y > canvas.height) star.y = -star.size;
            });
        }

        function drawSpaceship() {
            spaceship.wingAngle = Math.sin(Date.now() * 0.01) * 5;
            spaceship.flameSize = (rightPressed || leftPressed) ? Math.random() * 5 + 10 : 5;

            ctx.save();
            ctx.translate(spaceship.x, spaceship.y);
            ctx.shadowBlur = 20;
            ctx.shadowColor = 'cyan';

            ctx.fillStyle = 'silver';
            ctx.beginPath();
            ctx.moveTo(0, -spaceship.height / 2);
            ctx.lineTo(-spaceship.width / 2, spaceship.height / 2);
            ctx.lineTo(spaceship.width / 2, spaceship.height / 2);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = 'gray';
            ctx.beginPath();
            ctx.moveTo(-spaceship.width / 2, spaceship.height / 2);
            ctx.lineTo(-spaceship.width / 2 - 10, spaceship.height + spaceship.wingAngle);
            ctx.lineTo(-spaceship.width / 2 + 10, spaceship.height / 2);
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(spaceship.width / 2, spaceship.height / 2);
            ctx.lineTo(spaceship.width / 2 + 10, spaceship.height + spaceship.wingAngle);
            ctx.lineTo(spaceship.width / 2 - 10, spaceship.height / 2);
            ctx.fill();

            ctx.fillStyle = 'orange';
            ctx.beginPath();
            ctx.moveTo(-spaceship.width / 4, spaceship.height / 2);
            ctx.lineTo(0, spaceship.height / 2 + spaceship.flameSize);
            ctx.lineTo(spaceship.width / 4, spaceship.height / 2);
            ctx.fill();

            ctx.fillStyle = 'cyan';
            ctx.beginPath();
            ctx.arc(0, -spaceship.height / 4, 5, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function drawBullets() {
            bullets.forEach(bullet => {
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(255, 0, 0, 0.5)';
                ctx.lineWidth = 2;
                ctx.moveTo(bullet.x, bullet.y);
                ctx.lineTo(bullet.x, bullet.y + 15);
                ctx.stroke();
                ctx.fillStyle = 'red';
                ctx.fillRect(bullet.x - 2, bullet.y, 4, 10);
            });
        }

        function drawShapes() {
            shapes.forEach(shape => {
                ctx.save();
                ctx.translate(shape.x + shape.size / 2, shape.y + shape.size / 2);
                ctx.rotate(shape.rotation);
                ctx.fillStyle = shape.color;
                ctx.beginPath();
                if (shape.type === 'square') {
                    ctx.fillRect(-shape.size / 2, -shape.size / 2, shape.size, shape.size);
                } else if (shape.type === 'triangle') {
                    ctx.moveTo(0, -shape.size / 2);
                    ctx.lineTo(-shape.size / 2, shape.size / 2);
                    ctx.lineTo(shape.size / 2, shape.size / 2);
                    ctx.closePath();
                    ctx.fill();
                } else if (shape.type === 'circle') {
                    ctx.arc(0, 0, shape.size / 2, 0, Math.PI * 2);
                    ctx.fill();
                } else if (shape.type === 'pentagon') {
                    const angle = Math.PI * 2 / 5;
                    ctx.moveTo(shape.size / 2 * Math.cos(0), shape.size / 2 * Math.sin(0));
                    for (let i = 1; i <= 5; i++) {
                        ctx.lineTo(shape.size / 2 * Math.cos(angle * i), shape.size / 2 * Math.sin(angle * i));
                    }
                    ctx.closePath();
                    ctx.fill();
                }
                ctx.restore();
                shape.rotation += shape.rotationSpeed;
            });
        }

        function drawParticles() {
            particles.forEach((particle, index) => {
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
                particle.x += particle.speedX;
                particle.y += particle.speedY;
                particle.life--;
                particle.size *= 0.95;
                if (particle.life <= 0) particles.splice(index, 1);
            });
        }

        function update() {
            if (rightPressed && spaceship.x + spaceship.width / 2 + 10 < canvas.width) {
                spaceship.x += spaceship.speed;
            }
            if (leftPressed && spaceship.x - spaceship.width / 2 - 10 > 0) {
                spaceship.x -= spaceship.speed;
            }

            if (spacePressed && bullets.length < 10) {
                bullets.push({ x: spaceship.x, y: spaceship.y - spaceship.height / 2 });
                spacePressed = false;
            }

            bullets = bullets.filter(b => b.y > -10);
            bullets.forEach(b => b.y -= 5);

            shapes.forEach(shape => shape.y += shape.speed);

            shapes = shapes.filter(shape => {
                if (shape.y > canvas.height) {
                    score -= shape.points;
                    if (score < 0) score = 0;
                    return false;
                }
                return true;
            });

            bullets.forEach((bullet, bIndex) => {
                shapes.forEach((shape, sIndex) => {
                    const dx = bullet.x - (shape.x + shape.size / 2);
                    const dy = bullet.y - (shape.y + shape.size / 2);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < shape.size / 2 + 2) {
                        createExplosion(shape.x + shape.size / 2, shape.y + shape.size / 2, shape.color);
                        shapes.splice(sIndex, 1);
                        bullets.splice(bIndex, 1);
                        score += shape.points;
                    }
                });
            });

            shapes.forEach((shape, index) => {
                const dx = spaceship.x - (shape.x + shape.size / 2);
                const dy = (spaceship.y - spaceship.height / 2) - (shape.y + shape.size / 2);
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < (shape.size / 2 + spaceship.width / 2)) {
                    createExplosion(spaceship.x, spaceship.y, 'orange', true);
                    spaceship.lives--;
                    shapes.splice(index, 1);
                    if (spaceship.lives <= 0) {
                        endGame();
                    }
                }
            });

            if (shake > 0) shake--;
        }

        function drawScore() {
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText(`ניקוד:`, 10, 25);
            ctx.fillText(`${score}`, 80, 25);
            ctx.fillText(`חיים:`, canvas.width - 100, 25);
            ctx.fillText(`${spaceship.lives}`, canvas.width - 30, 25);

            // תיבות UI
            ctx.strokeStyle = 'cyan';
            ctx.lineWidth = 2;
            ctx.strokeRect(5, 5, 100, 30); // תיבת ניקוד
            ctx.strokeRect(canvas.width - 105, 5, 100, 30); // תיבת חיים
        }

        function gameLoop() {
            ctx.save();
            if (shake > 0) {
                ctx.translate(Math.random() * shake - shake / 2, Math.random() * shake - shake / 2);
            }
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawStars();
            drawSpaceship();
            drawBullets();
            drawShapes();
            drawParticles();
            drawScore();
            update();

            if (Math.random() < 0.015) spawnShape();

            ctx.restore();
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            introScreen.style.display = 'none';
            canvas.style.display = 'block';
            document.addEventListener('keydown', keyDownHandler);
            document.addEventListener('keyup', keyUpHandler);
            gameLoop();
        }

        function endGame() {
            canvas.style.display = 'none';
            endScreen.style.display = 'block';
            finalScoreText.textContent = `ניקוד סופי: ${score}`;
            document.removeEventListener('keydown', keyDownHandler);
            document.removeEventListener('keyup', keyUpHandler);
        }

        function restartGame() {
            endScreen.style.display = 'none';
            canvas.style.display = 'block';
            spaceship.lives = 3;
            score = 0;
            shapes = [];
            bullets = [];
            particles = [];
            spaceship.x = canvas.width / 2;
            document.addEventListener('keydown', keyDownHandler);
            document.addEventListener('keyup', keyUpHandler);
            gameLoop();
        }

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', restartGame);
    </script>
</body>
</html>